<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:MoneyMindApp.ViewModels"
             x:Class="MoneyMindApp.Views.SettingsPage"
             x:DataType="viewmodels:SettingsViewModel"
             Title="Impostazioni">

    <RefreshView Command="{Binding RefreshCommand}"
                 IsRefreshing="{Binding IsRefreshing}">
        <ScrollView>
            <VerticalStackLayout Padding="20,16,20,20" Spacing="20">

                <!-- Header -->
                <VerticalStackLayout Spacing="12">
                    <Label Text="Impostazioni"
                           FontFamily="PoppinsSemiBold"
                           FontSize="28"
                           TextColor="{StaticResource TextPrimary}" />

                    <Label Text="Configura l'app secondo le tue preferenze"
                           FontFamily="PoppinsRegular"
                           FontSize="14"
                           TextColor="{StaticResource TextSecondary}"
                           Opacity="0.9" />
                </VerticalStackLayout>

                <!-- License Card - Hero Style with Gradient -->
                <Border StrokeShape="RoundRectangle 20"
                        StrokeThickness="0"
                        Padding="20">
                    <Border.Shadow>
                        <Shadow Brush="{StaticResource Primary}" Opacity="0.25" Offset="0,4" Radius="12" />
                    </Border.Shadow>
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="{StaticResource Primary}" Offset="0.0" />
                            <GradientStop Color="{StaticResource PrimaryDark}" Offset="1.0" />
                        </LinearGradientBrush>
                    </Border.Background>

                    <VerticalStackLayout Spacing="16">
                        <!-- Shield Icon -->
                        <Border StrokeShape="RoundRectangle 20"
                                BackgroundColor="#40FFFFFF"
                                WidthRequest="56"
                                HeightRequest="56"
                                HorizontalOptions="Start">
                            <Path Data="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"
                                  Fill="White"
                                  Aspect="Uniform"
                                  HeightRequest="28"
                                  WidthRequest="28"
                                  HorizontalOptions="Center"
                                  VerticalOptions="Center" />
                        </Border>

                        <Label Text="Licenza Attiva"
                               FontFamily="PoppinsSemiBold"
                               FontSize="20"
                               TextColor="White" />

                        <!-- License Info -->
                        <Grid ColumnDefinitions="Auto,*"
                              RowDefinitions="Auto,Auto,Auto,Auto"
                              RowSpacing="10"
                              ColumnSpacing="16">

                            <Label Grid.Row="0" Grid.Column="0"
                                   Text="Email:"
                                   FontFamily="PoppinsRegular"
                                   FontSize="13"
                                   TextColor="White"
                                   Opacity="0.9"
                                   VerticalOptions="Center" />
                            <Label Grid.Row="0" Grid.Column="1"
                                   Text="{Binding LicenseEmail}"
                                   FontFamily="PoppinsSemiBold"
                                   FontSize="14"
                                   TextColor="White"
                                   LineBreakMode="TailTruncation" />

                            <Label Grid.Row="1" Grid.Column="0"
                                   Text="Piano:"
                                   FontFamily="PoppinsRegular"
                                   FontSize="13"
                                   TextColor="White"
                                   Opacity="0.9"
                                   VerticalOptions="Center" />
                            <Label Grid.Row="1" Grid.Column="1"
                                   Text="{Binding LicenseSubscription}"
                                   FontFamily="PoppinsSemiBold"
                                   FontSize="14"
                                   TextColor="White" />

                            <Label Grid.Row="2" Grid.Column="0"
                                   Text="Scadenza:"
                                   FontFamily="PoppinsRegular"
                                   FontSize="13"
                                   TextColor="White"
                                   Opacity="0.9"
                                   VerticalOptions="Center" />
                            <Label Grid.Row="2" Grid.Column="1"
                                   Text="{Binding LicenseExpiration}"
                                   FontFamily="PoppinsSemiBold"
                                   FontSize="14"
                                   TextColor="White" />

                            <Label Grid.Row="3" Grid.Column="0"
                                   Text="Versione:"
                                   FontFamily="PoppinsRegular"
                                   FontSize="13"
                                   TextColor="White"
                                   Opacity="0.9"
                                   VerticalOptions="Center" />
                            <Label Grid.Row="3" Grid.Column="1"
                                   Text="{Binding AppVersion}"
                                   FontFamily="PoppinsSemiBold"
                                   FontSize="14"
                                   TextColor="White" />
                        </Grid>

                        <!-- License Action Buttons -->
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12" Margin="0,4,0,0">
                            <Border Grid.Column="0"
                                    StrokeShape="RoundRectangle 12"
                                    BackgroundColor="#40FFFFFF"
                                    Padding="12,10">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding CheckLicenseCommand}" />
                                </Border.GestureRecognizers>
                                <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                                    <Path Data="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"
                                          Fill="White"
                                          Aspect="Uniform"
                                          HeightRequest="18"
                                          WidthRequest="18"
                                          VerticalOptions="Center" />
                                    <Label Text="Verifica"
                                           FontFamily="PoppinsSemiBold"
                                           FontSize="14"
                                           TextColor="White"
                                           VerticalOptions="Center" />
                                </HorizontalStackLayout>
                            </Border>

                            <Border Grid.Column="1"
                                    StrokeShape="RoundRectangle 12"
                                    BackgroundColor="{StaticResource Danger}"
                                    Padding="12,10">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding LogoutCommand}" />
                                </Border.GestureRecognizers>
                                <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                                    <Path Data="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"
                                          Fill="White"
                                          Aspect="Uniform"
                                          HeightRequest="18"
                                          WidthRequest="18"
                                          VerticalOptions="Center" />
                                    <Label Text="Logout"
                                           FontFamily="PoppinsSemiBold"
                                           FontSize="14"
                                           TextColor="White"
                                           VerticalOptions="Center" />
                                </HorizontalStackLayout>
                            </Border>
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <!-- Appearance Section -->
                <Border StrokeShape="RoundRectangle 16"
                        StrokeThickness="0"
                        Padding="20"
                        BackgroundColor="White">
                    <Border.Shadow>
                        <Shadow Brush="Black" Opacity="0.08" Offset="0,2" Radius="8" />
                    </Border.Shadow>

                    <VerticalStackLayout Spacing="16">
                        <HorizontalStackLayout Spacing="12">
                            <Border StrokeShape="RoundRectangle 12"
                                    BackgroundColor="{StaticResource PrimaryContainer}"
                                    Padding="12"
                                    VerticalOptions="Start">
                                <Path Data="M9 2c-1.05 0-2.05.16-3 .46 4.06 1.27 7 5.06 7 9.54 0 4.48-2.94 8.27-7 9.54.95.3 1.95.46 3 .46 5.52 0 10-4.48 10-10S14.52 2 9 2z"
                                      Fill="{StaticResource Primary}"
                                      Aspect="Uniform"
                                      HeightRequest="20"
                                      WidthRequest="20" />
                            </Border>
                            <VerticalStackLayout Spacing="2" VerticalOptions="Center">
                                <Label Text="Aspetto"
                                       FontFamily="PoppinsSemiBold"
                                       FontSize="18"
                                       TextColor="{StaticResource TextPrimary}" />
                                <Label Text="Personalizza l'interfaccia"
                                       FontFamily="PoppinsRegular"
                                       FontSize="11"
                                       TextColor="{StaticResource TextSecondary}"
                                       Opacity="0.8" />
                            </VerticalStackLayout>
                        </HorizontalStackLayout>

                        <!-- Theme Picker -->
                        <HorizontalStackLayout Spacing="12">
                            <Label Text="Tema:"
                                   FontFamily="PoppinsRegular"
                                   FontSize="15"
                                   TextColor="{StaticResource TextPrimary}"
                                   VerticalOptions="Center"
                                   WidthRequest="100" />
                            <Border StrokeShape="RoundRectangle 8"
                                    Stroke="{StaticResource Primary}"
                                    StrokeThickness="2"
                                    BackgroundColor="Transparent"
                                    HorizontalOptions="FillAndExpand">
                                <Picker ItemsSource="{Binding AvailableThemes}"
                                        SelectedItem="{Binding SelectedTheme}"
                                        FontFamily="PoppinsRegular"
                                        FontSize="15"
                                        TextColor="{StaticResource TextPrimary}"
                                        BackgroundColor="Transparent"
                                        Margin="8,0" />
                            </Border>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- Transaction Grouping Section -->
                <Border StrokeShape="RoundRectangle 16"
                        StrokeThickness="0"
                        Padding="20"
                        BackgroundColor="White">
                    <Border.Shadow>
                        <Shadow Brush="Black" Opacity="0.08" Offset="0,2" Radius="8" />
                    </Border.Shadow>

                    <VerticalStackLayout Spacing="16">
                        <HorizontalStackLayout Spacing="12">
                            <Border StrokeShape="RoundRectangle 12"
                                    BackgroundColor="{StaticResource BalanceBackground}"
                                    Padding="12"
                                    VerticalOptions="Start">
                                <Path Data="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"
                                      Fill="{StaticResource Info}"
                                      Aspect="Uniform"
                                      HeightRequest="20"
                                      WidthRequest="20" />
                            </Border>
                            <VerticalStackLayout Spacing="2" VerticalOptions="Center" HorizontalOptions="FillAndExpand">
                                <Label Text="Raggruppamento"
                                       FontFamily="PoppinsSemiBold"
                                       FontSize="18"
                                       TextColor="{StaticResource TextPrimary}" />
                                <Label Text="Modalità di visualizzazione transazioni"
                                       FontFamily="PoppinsRegular"
                                       FontSize="11"
                                       TextColor="{StaticResource TextSecondary}"
                                       Opacity="0.8" />
                            </VerticalStackLayout>
                        </HorizontalStackLayout>

                        <!-- Grouping Mode Picker -->
                        <HorizontalStackLayout Spacing="12">
                            <Label Text="Raggruppa per:"
                                   FontFamily="PoppinsRegular"
                                   FontSize="15"
                                   TextColor="{StaticResource TextPrimary}"
                                   VerticalOptions="Center"
                                   WidthRequest="100" />
                            <Border StrokeShape="RoundRectangle 8"
                                    Stroke="{StaticResource Primary}"
                                    StrokeThickness="2"
                                    BackgroundColor="Transparent"
                                    HorizontalOptions="FillAndExpand">
                                <Picker ItemsSource="{Binding AvailableTransactionGroupings}"
                                        SelectedItem="{Binding SelectedTransactionGrouping}"
                                        FontFamily="PoppinsRegular"
                                        FontSize="15"
                                        TextColor="{StaticResource TextPrimary}"
                                        BackgroundColor="Transparent"
                                        Margin="8,0" />
                            </Border>
                        </HorizontalStackLayout>

                        <Border StrokeShape="RoundRectangle 8"
                                BackgroundColor="{StaticResource Gray100}"
                                Padding="12">
                            <Label FontFamily="PoppinsRegular"
                                   FontSize="12"
                                   TextColor="{StaticResource Gray700}"
                                   LineHeight="1.4">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="• Mese Solare: " FontAttributes="Bold" />
                                        <Span Text="dal 1° all'ultimo giorno del mese" />
                                        <Span Text="&#x0a;• Mese Stipendiale: " FontAttributes="Bold" />
                                        <Span Text="dal giorno stipendio al successivo" />
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                        </Border>
                    </VerticalStackLayout>
                </Border>

                <!-- Security Section -->
                <Border StrokeShape="RoundRectangle 16"
                        StrokeThickness="0"
                        Padding="20"
                        BackgroundColor="White">
                    <Border.Shadow>
                        <Shadow Brush="Black" Opacity="0.08" Offset="0,2" Radius="8" />
                    </Border.Shadow>

                    <VerticalStackLayout Spacing="16">
                        <HorizontalStackLayout Spacing="12">
                            <Border StrokeShape="RoundRectangle 12"
                                    BackgroundColor="{StaticResource IncomeBackground}"
                                    Padding="12"
                                    VerticalOptions="Start">
                                <Path Data="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"
                                      Fill="{StaticResource Success}"
                                      Aspect="Uniform"
                                      HeightRequest="20"
                                      WidthRequest="20" />
                            </Border>
                            <VerticalStackLayout Spacing="2" VerticalOptions="Center" HorizontalOptions="FillAndExpand">
                                <Label Text="Sicurezza"
                                       FontFamily="PoppinsSemiBold"
                                       FontSize="18"
                                       TextColor="{StaticResource TextPrimary}" />
                                <Label Text="Proteggi i tuoi dati finanziari"
                                       FontFamily="PoppinsRegular"
                                       FontSize="11"
                                       TextColor="{StaticResource TextSecondary}"
                                       Opacity="0.8" />
                            </VerticalStackLayout>
                        </HorizontalStackLayout>

                        <!-- Biometric Auth Toggle -->
                        <HorizontalStackLayout Spacing="12">
                            <Label Text="Sblocco Biometrico"
                                   FontFamily="PoppinsRegular"
                                   FontSize="15"
                                   TextColor="{StaticResource TextPrimary}"
                                   VerticalOptions="Center"
                                   HorizontalOptions="FillAndExpand" />
                            <Switch IsToggled="{Binding BiometricEnabled}"
                                    OnColor="{StaticResource Success}" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- WiFi Sync Section -->
                <Border StrokeShape="RoundRectangle 16"
                        StrokeThickness="0"
                        Padding="20"
                        BackgroundColor="White">
                    <Border.Shadow>
                        <Shadow Brush="Black" Opacity="0.08" Offset="0,2" Radius="8" />
                    </Border.Shadow>

                    <VerticalStackLayout Spacing="16">
                        <HorizontalStackLayout Spacing="12">
                            <Border StrokeShape="RoundRectangle 12"
                                    BackgroundColor="{StaticResource SavingsBackground}"
                                    Padding="12"
                                    VerticalOptions="Start">
                                <Path Data="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"
                                      Fill="{StaticResource Balance}"
                                      Aspect="Uniform"
                                      HeightRequest="20"
                                      WidthRequest="20" />
                            </Border>
                            <VerticalStackLayout Spacing="2" VerticalOptions="Center" HorizontalOptions="FillAndExpand">
                                <Label Text="WiFi Sync"
                                       FontFamily="PoppinsSemiBold"
                                       FontSize="18"
                                       TextColor="{StaticResource TextPrimary}" />
                                <Label Text="Sincronizza con l'app Desktop"
                                       FontFamily="PoppinsRegular"
                                       FontSize="11"
                                       TextColor="{StaticResource TextSecondary}"
                                       Opacity="0.8" />
                            </VerticalStackLayout>
                        </HorizontalStackLayout>

                        <Label Text="Sincronizza i dati con l'app Desktop tramite WiFi o Hotspot in modo sicuro e veloce."
                               FontFamily="PoppinsRegular"
                               FontSize="13"
                               TextColor="{StaticResource Gray600}"
                               LineHeight="1.4" />

                        <Border StrokeShape="RoundRectangle 12"
                                BackgroundColor="{StaticResource Balance}"
                                Padding="14,12">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding OpenWiFiSyncCommand}" />
                            </Border.GestureRecognizers>
                            <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                                <Path Data="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"
                                      Fill="White"
                                      Aspect="Uniform"
                                      HeightRequest="18"
                                      WidthRequest="18"
                                      VerticalOptions="Center" />
                                <Label Text="Apri Sincronizzazione"
                                       FontFamily="PoppinsSemiBold"
                                       FontSize="15"
                                       TextColor="White"
                                       VerticalOptions="Center" />
                            </HorizontalStackLayout>
                        </Border>
                    </VerticalStackLayout>
                </Border>

                <!-- Data Section -->
                <Border StrokeShape="RoundRectangle 16"
                        StrokeThickness="0"
                        Padding="20"
                        BackgroundColor="White">
                    <Border.Shadow>
                        <Shadow Brush="Black" Opacity="0.08" Offset="0,2" Radius="8" />
                    </Border.Shadow>

                    <VerticalStackLayout Spacing="16">
                        <HorizontalStackLayout Spacing="12">
                            <Border StrokeShape="RoundRectangle 12"
                                    BackgroundColor="{StaticResource SecondaryContainer}"
                                    Padding="12"
                                    VerticalOptions="Start">
                                <Path Data="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"
                                      Fill="{StaticResource Secondary}"
                                      Aspect="Uniform"
                                      HeightRequest="20"
                                      WidthRequest="20" />
                            </Border>
                            <VerticalStackLayout Spacing="2" VerticalOptions="Center" HorizontalOptions="FillAndExpand">
                                <Label Text="Dati"
                                       FontFamily="PoppinsSemiBold"
                                       FontSize="18"
                                       TextColor="{StaticResource TextPrimary}" />
                                <Label Text="Gestisci database e backup"
                                       FontFamily="PoppinsRegular"
                                       FontSize="11"
                                       TextColor="{StaticResource TextSecondary}"
                                       Opacity="0.8" />
                            </VerticalStackLayout>
                        </HorizontalStackLayout>

                        <!-- Database Stats -->
                        <Grid ColumnDefinitions="Auto,*"
                              RowDefinitions="Auto,Auto,Auto"
                              RowSpacing="10"
                              ColumnSpacing="16">

                            <Label Grid.Row="0" Grid.Column="0"
                                   Text="Dimensione DB:"
                                   FontFamily="PoppinsRegular"
                                   FontSize="13"
                                   TextColor="{StaticResource Gray600}"
                                   VerticalOptions="Center" />
                            <Label Grid.Row="0" Grid.Column="1"
                                   Text="{Binding DatabaseSize}"
                                   FontFamily="PoppinsSemiBold"
                                   FontSize="15"
                                   TextColor="{StaticResource TextPrimary}" />

                            <Label Grid.Row="1" Grid.Column="0"
                                   Text="Transazioni:"
                                   FontFamily="PoppinsRegular"
                                   FontSize="13"
                                   TextColor="{StaticResource Gray600}"
                                   VerticalOptions="Center" />
                            <Label Grid.Row="1" Grid.Column="1"
                                   Text="{Binding TotalTransactions}"
                                   FontFamily="PoppinsSemiBold"
                                   FontSize="15"
                                   TextColor="{StaticResource TextPrimary}" />

                            <Label Grid.Row="2" Grid.Column="0"
                                   Text="Conti:"
                                   FontFamily="PoppinsRegular"
                                   FontSize="13"
                                   TextColor="{StaticResource Gray600}"
                                   VerticalOptions="Center" />
                            <Label Grid.Row="2" Grid.Column="1"
                                   Text="{Binding TotalAccounts}"
                                   FontFamily="PoppinsSemiBold"
                                   FontSize="15"
                                   TextColor="{StaticResource TextPrimary}" />
                        </Grid>

                        <!-- Backup Toggle -->
                        <HorizontalStackLayout Spacing="12">
                            <Label Text="Backup su Cloud"
                                   FontFamily="PoppinsRegular"
                                   FontSize="15"
                                   TextColor="{StaticResource TextPrimary}"
                                   VerticalOptions="Center"
                                   HorizontalOptions="FillAndExpand" />
                            <Switch IsToggled="{Binding BackupOnCloud}"
                                    OnColor="{StaticResource Info}" />
                        </HorizontalStackLayout>

                        <!-- Backup Buttons -->
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <Border Grid.Column="0"
                                    StrokeShape="RoundRectangle 12"
                                    BackgroundColor="{StaticResource Info}"
                                    Padding="12,10">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding BackupDatabaseCommand}" />
                                </Border.GestureRecognizers>
                                <HorizontalStackLayout Spacing="6" HorizontalOptions="Center">
                                    <Path Data="M19.35 10.04C18.67 6.59 15.64 4 12 4c-1.48 0-2.85.43-4.01 1.17l1.46 1.46C10.21 6.23 11.08 6 12 6c3.04 0 5.5 2.46 5.5 5.5v.5H19c1.66 0 3 1.34 3 3 0 1.13-.64 2.11-1.56 2.62l1.45 1.45C23.16 18.16 24 16.68 24 15c0-2.64-2.05-4.78-4.65-4.96zM3 5.27l2.75 2.74C2.56 8.15 0 10.77 0 14c0 3.31 2.69 6 6 6h11.73l2 2L21 20.73 4.27 4 3 5.27zM7.73 10l8 8H6c-2.21 0-4-1.79-4-4s1.79-4 4-4h1.73z"
                                          Fill="White"
                                          Aspect="Uniform"
                                          HeightRequest="16"
                                          WidthRequest="16"
                                          VerticalOptions="Center" />
                                    <Label Text="Backup"
                                           FontFamily="PoppinsSemiBold"
                                           FontSize="14"
                                           TextColor="White"
                                           VerticalOptions="Center" />
                                </HorizontalStackLayout>
                            </Border>

                            <Border Grid.Column="1"
                                    StrokeShape="RoundRectangle 12"
                                    BackgroundColor="{StaticResource Warning}"
                                    Padding="12,10">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding RestoreDatabaseCommand}" />
                                </Border.GestureRecognizers>
                                <HorizontalStackLayout Spacing="6" HorizontalOptions="Center">
                                    <Path Data="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"
                                          Fill="White"
                                          Aspect="Uniform"
                                          HeightRequest="16"
                                          WidthRequest="16"
                                          VerticalOptions="Center" />
                                    <Label Text="Ripristina"
                                           FontFamily="PoppinsSemiBold"
                                           FontSize="14"
                                           TextColor="White"
                                           VerticalOptions="Center" />
                                </HorizontalStackLayout>
                            </Border>
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <!-- Notifications Section -->
                <Border StrokeShape="RoundRectangle 16"
                        StrokeThickness="0"
                        Padding="20"
                        BackgroundColor="White">
                    <Border.Shadow>
                        <Shadow Brush="Black" Opacity="0.08" Offset="0,2" Radius="8" />
                    </Border.Shadow>

                    <VerticalStackLayout Spacing="16">
                        <HorizontalStackLayout Spacing="12">
                            <Border StrokeShape="RoundRectangle 12"
                                    BackgroundColor="{StaticResource WarningLight}"
                                    Opacity="0.3"
                                    Padding="12"
                                    VerticalOptions="Start">
                                <Path Data="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"
                                      Fill="{StaticResource Warning}"
                                      Aspect="Uniform"
                                      HeightRequest="20"
                                      WidthRequest="20" />
                            </Border>
                            <VerticalStackLayout Spacing="2" VerticalOptions="Center" HorizontalOptions="FillAndExpand">
                                <Label Text="Notifiche"
                                       FontFamily="PoppinsSemiBold"
                                       FontSize="18"
                                       TextColor="{StaticResource TextPrimary}" />
                                <Label Text="Ricevi avvisi importanti"
                                       FontFamily="PoppinsRegular"
                                       FontSize="11"
                                       TextColor="{StaticResource TextSecondary}"
                                       Opacity="0.8" />
                            </VerticalStackLayout>
                        </HorizontalStackLayout>

                        <HorizontalStackLayout Spacing="12">
                            <Label Text="Mostra Notifiche"
                                   FontFamily="PoppinsRegular"
                                   FontSize="15"
                                   TextColor="{StaticResource TextPrimary}"
                                   VerticalOptions="Center"
                                   HorizontalOptions="FillAndExpand" />
                            <Switch IsToggled="{Binding ShowNotifications}"
                                    OnColor="{StaticResource Warning}" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- Updates Section -->
                <Border StrokeShape="RoundRectangle 16"
                        StrokeThickness="0"
                        Padding="20"
                        BackgroundColor="White">
                    <Border.Shadow>
                        <Shadow Brush="Black" Opacity="0.08" Offset="0,2" Radius="8" />
                    </Border.Shadow>

                    <VerticalStackLayout Spacing="16">
                        <HorizontalStackLayout Spacing="12">
                            <Border StrokeShape="RoundRectangle 12"
                                    BackgroundColor="{StaticResource TertiaryContainer}"
                                    Padding="12"
                                    VerticalOptions="Start">
                                <Path Data="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"
                                      Fill="{StaticResource Tertiary}"
                                      Aspect="Uniform"
                                      HeightRequest="20"
                                      WidthRequest="20" />
                            </Border>
                            <VerticalStackLayout Spacing="2" VerticalOptions="Center" HorizontalOptions="FillAndExpand">
                                <Label Text="Aggiornamenti"
                                       FontFamily="PoppinsSemiBold"
                                       FontSize="18"
                                       TextColor="{StaticResource TextPrimary}" />
                                <Label Text="Mantieni l'app sempre aggiornata"
                                       FontFamily="PoppinsRegular"
                                       FontSize="11"
                                       TextColor="{StaticResource TextSecondary}"
                                       Opacity="0.8" />
                            </VerticalStackLayout>
                        </HorizontalStackLayout>

                        <Label Text="Controlla se sono disponibili nuove versioni dell'app con miglioramenti e correzioni."
                               FontFamily="PoppinsRegular"
                               FontSize="13"
                               TextColor="{StaticResource Gray600}"
                               LineHeight="1.4" />

                        <Border StrokeShape="RoundRectangle 12"
                                BackgroundColor="{StaticResource Tertiary}"
                                Padding="14,12">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding CheckUpdatesCommand}" />
                            </Border.GestureRecognizers>
                            <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                                <Path Data="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"
                                      Fill="White"
                                      Aspect="Uniform"
                                      HeightRequest="18"
                                      WidthRequest="18"
                                      VerticalOptions="Center" />
                                <Label Text="Verifica Aggiornamenti"
                                       FontFamily="PoppinsSemiBold"
                                       FontSize="15"
                                       TextColor="White"
                                       VerticalOptions="Center" />
                            </HorizontalStackLayout>
                        </Border>
                    </VerticalStackLayout>
                </Border>

                <!-- Advanced Section -->
                <Border StrokeShape="RoundRectangle 16"
                        StrokeThickness="0"
                        Padding="20"
                        BackgroundColor="White">
                    <Border.Shadow>
                        <Shadow Brush="Black" Opacity="0.08" Offset="0,2" Radius="8" />
                    </Border.Shadow>

                    <VerticalStackLayout Spacing="16">
                        <HorizontalStackLayout Spacing="12">
                            <Border StrokeShape="RoundRectangle 12"
                                    BackgroundColor="{StaticResource Gray200}"
                                    Padding="12"
                                    VerticalOptions="Start">
                                <Path Data="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"
                                      Fill="{StaticResource Gray700}"
                                      Aspect="Uniform"
                                      HeightRequest="20"
                                      WidthRequest="20" />
                            </Border>
                            <VerticalStackLayout Spacing="2" VerticalOptions="Center" HorizontalOptions="FillAndExpand">
                                <Label Text="Avanzate"
                                       FontFamily="PoppinsSemiBold"
                                       FontSize="18"
                                       TextColor="{StaticResource TextPrimary}" />
                                <Label Text="Opzioni per utenti esperti"
                                       FontFamily="PoppinsRegular"
                                       FontSize="11"
                                       TextColor="{StaticResource TextSecondary}"
                                       Opacity="0.8" />
                            </VerticalStackLayout>
                        </HorizontalStackLayout>

                        <!-- View Logs Button -->
                        <Border StrokeShape="RoundRectangle 12"
                                Stroke="{StaticResource Gray400}"
                                StrokeThickness="1.5"
                                BackgroundColor="Transparent"
                                Padding="14,12">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding ViewLogsCommand}" />
                            </Border.GestureRecognizers>
                            <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                                <Path Data="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"
                                      Fill="{StaticResource Gray600}"
                                      Aspect="Uniform"
                                      HeightRequest="16"
                                      WidthRequest="16"
                                      VerticalOptions="Center" />
                                <Label Text="Visualizza Log"
                                       FontFamily="PoppinsSemiBold"
                                       FontSize="14"
                                       TextColor="{StaticResource Gray700}"
                                       VerticalOptions="Center" />
                            </HorizontalStackLayout>
                        </Border>

                        <!-- Export Logs Button -->
                        <Border StrokeShape="RoundRectangle 12"
                                Stroke="{StaticResource Gray400}"
                                StrokeThickness="1.5"
                                BackgroundColor="Transparent"
                                Padding="14,12">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding ExportLogsCommand}" />
                            </Border.GestureRecognizers>
                            <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                                <Path Data="M19.35 10.04C18.67 6.59 15.64 4 12 4c-1.48 0-2.85.43-4.01 1.17l1.46 1.46C10.21 6.23 11.08 6 12 6c3.04 0 5.5 2.46 5.5 5.5v.5H19c1.66 0 3 1.34 3 3 0 1.13-.64 2.11-1.56 2.62l1.45 1.45C23.16 18.16 24 16.68 24 15c0-2.64-2.05-4.78-4.65-4.96zM3 5.27l2.75 2.74C2.56 8.15 0 10.77 0 14c0 3.31 2.69 6 6 6h11.73l2 2L21 20.73 4.27 4 3 5.27zM7.73 10l8 8H6c-2.21 0-4-1.79-4-4s1.79-4 4-4h1.73z"
                                      Fill="{StaticResource Gray600}"
                                      Aspect="Uniform"
                                      HeightRequest="16"
                                      WidthRequest="16"
                                      VerticalOptions="Center" />
                                <Label Text="Esporta Log"
                                       FontFamily="PoppinsSemiBold"
                                       FontSize="14"
                                       TextColor="{StaticResource Gray700}"
                                       VerticalOptions="Center" />
                            </HorizontalStackLayout>
                        </Border>

                        <!-- Clear Cache Button -->
                        <Border StrokeShape="RoundRectangle 12"
                                Stroke="{StaticResource Gray400}"
                                StrokeThickness="1.5"
                                BackgroundColor="Transparent"
                                Padding="14,12">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding ClearCacheCommand}" />
                            </Border.GestureRecognizers>
                            <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                                <Path Data="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"
                                      Fill="{StaticResource Gray600}"
                                      Aspect="Uniform"
                                      HeightRequest="16"
                                      WidthRequest="16"
                                      VerticalOptions="Center" />
                                <Label Text="Cancella Cache"
                                       FontFamily="PoppinsSemiBold"
                                       FontSize="14"
                                       TextColor="{StaticResource Gray700}"
                                       VerticalOptions="Center" />
                            </HorizontalStackLayout>
                        </Border>

                        <!-- Admin Panel Button (visible only if admin) -->
                        <Border StrokeShape="RoundRectangle 12"
                                BackgroundColor="{StaticResource Danger}"
                                Padding="14,12"
                                IsVisible="{Binding IsAdmin}">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding OpenAdminPanelCommand}" />
                            </Border.GestureRecognizers>
                            <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                                <Path Data="M12 2l-5.5 9h11L12 2zm0 3.84L13.93 9h-3.87L12 5.84zM17.5 13c-2.49 0-4.5 2.01-4.5 4.5s2.01 4.5 4.5 4.5 4.5-2.01 4.5-4.5-2.01-4.5-4.5-4.5zm0 7c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5zM3 21.5h8v-8H3v8zm2-6h4v4H5v-4z"
                                      Fill="White"
                                      Aspect="Uniform"
                                      HeightRequest="18"
                                      WidthRequest="18"
                                      VerticalOptions="Center" />
                                <Label Text="Pannello Admin"
                                       FontFamily="PoppinsSemiBold"
                                       FontSize="15"
                                       TextColor="White"
                                       VerticalOptions="Center" />
                            </HorizontalStackLayout>
                        </Border>
                    </VerticalStackLayout>
                </Border>

                <!-- Footer (tap 5 times quickly to activate admin mode) -->
                <Label Text="MoneyMind © 2025 - Tutti i diritti riservati"
                       FontFamily="PoppinsRegular"
                       FontSize="11"
                       TextColor="{StaticResource Gray500}"
                       HorizontalOptions="Center"
                       Margin="0,8,0,0">
                    <Label.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding ToggleAdminModeCommand}" />
                    </Label.GestureRecognizers>
                </Label>

            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>
