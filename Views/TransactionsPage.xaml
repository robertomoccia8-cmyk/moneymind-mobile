<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MoneyMindApp.ViewModels"
             xmlns:models="clr-namespace:MoneyMindApp.Models"
             x:Class="MoneyMindApp.Views.TransactionsPage"
             x:DataType="vm:TransactionsViewModel"
             Title="Transazioni"
             Shell.NavBarIsVisible="True"
             BackgroundColor="{AppThemeBinding Light={StaticResource BackgroundLight}, Dark={StaticResource BackgroundDark}}">

    <Grid RowDefinitions="Auto,*">

        <!-- Search & Filters Section (Cleaner) -->
        <VerticalStackLayout Grid.Row="0" Spacing="12" Padding="16,16,16,8">

            <!-- Search Bar (Clean & Modern) -->
            <Grid ColumnDefinitions="*,Auto,Auto,Auto" ColumnSpacing="8">

                <!-- Search Field -->
                <Border Grid.Column="0"
                        StrokeShape="RoundRectangle 14"
                        Stroke="{AppThemeBinding Light={StaticResource OutlineVariant}, Dark={StaticResource Outline}}"
                        StrokeThickness="1"
                        BackgroundColor="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource SurfaceDark}}">
                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10" Padding="14,12">
                        <!-- Search Icon -->
                        <Label Grid.Column="0"
                               Text="ðŸ”"
                               FontSize="18"
                               VerticalOptions="Center"
                               Opacity="0.6" />

                        <!-- Entry -->
                        <Entry Grid.Column="1"
                               Placeholder="Cerca..."
                               Text="{Binding SearchText}"
                               ClearButtonVisibility="WhileEditing"
                               BackgroundColor="Transparent"
                               VerticalOptions="Center" />

                        <!-- Filter Badge (inside search) -->
                        <Border Grid.Column="2"
                                StrokeShape="RoundRectangle 10"
                                WidthRequest="20"
                                HeightRequest="20"
                                IsVisible="{Binding HasActiveFilters}"
                                VerticalOptions="Center"
                                BackgroundColor="{StaticResource Primary}">
                            <Label Text="{Binding ActiveFiltersCount}"
                                   FontSize="10"
                                   FontAttributes="Bold"
                                   TextColor="White"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                        </Border>
                    </Grid>
                </Border>

                <!-- Multi-Select Button (Better Icon) -->
                <Border Grid.Column="1"
                        StrokeShape="RoundRectangle 14"
                        Stroke="{AppThemeBinding Light={StaticResource OutlineVariant}, Dark={StaticResource Outline}}"
                        StrokeThickness="1"
                        BackgroundColor="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource SurfaceDark}}"
                        WidthRequest="44"
                        HeightRequest="44"
                        IsVisible="{Binding IsMultiSelectMode, Converter={StaticResource InverseBoolConverter}}">
                    <!-- Custom Multi-Select Icon (3 checkboxes stacked) -->
                    <VerticalStackLayout Spacing="3" HorizontalOptions="Center" VerticalOptions="Center">
                        <Grid ColumnDefinitions="Auto,Auto" ColumnSpacing="4">
                            <BoxView Grid.Column="0" WidthRequest="10" HeightRequest="10" CornerRadius="2" Color="{AppThemeBinding Light={StaticResource OnSurface}, Dark={StaticResource TextPrimaryDark}}" Opacity="0.4" />
                            <BoxView Grid.Column="1" WidthRequest="12" HeightRequest="2" CornerRadius="1" Color="{AppThemeBinding Light={StaticResource OnSurface}, Dark={StaticResource TextPrimaryDark}}" Opacity="0.5" VerticalOptions="Center" />
                        </Grid>
                        <Grid ColumnDefinitions="Auto,Auto" ColumnSpacing="4">
                            <BoxView Grid.Column="0" WidthRequest="10" HeightRequest="10" CornerRadius="2" Color="{AppThemeBinding Light={StaticResource OnSurface}, Dark={StaticResource TextPrimaryDark}}" Opacity="0.4" />
                            <BoxView Grid.Column="1" WidthRequest="12" HeightRequest="2" CornerRadius="1" Color="{AppThemeBinding Light={StaticResource OnSurface}, Dark={StaticResource TextPrimaryDark}}" Opacity="0.5" VerticalOptions="Center" />
                        </Grid>
                        <Grid ColumnDefinitions="Auto,Auto" ColumnSpacing="4">
                            <BoxView Grid.Column="0" WidthRequest="10" HeightRequest="10" CornerRadius="2" Color="{AppThemeBinding Light={StaticResource OnSurface}, Dark={StaticResource TextPrimaryDark}}" Opacity="0.4" />
                            <BoxView Grid.Column="1" WidthRequest="12" HeightRequest="2" CornerRadius="1" Color="{AppThemeBinding Light={StaticResource OnSurface}, Dark={StaticResource TextPrimaryDark}}" Opacity="0.5" VerticalOptions="Center" />
                        </Grid>
                    </VerticalStackLayout>
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding EnableMultiSelectCommand}" />
                    </Border.GestureRecognizers>
                </Border>

                <!-- Filter Button (Minimal Icon) -->
                <Border Grid.Column="2"
                        StrokeShape="RoundRectangle 14"
                        Stroke="{AppThemeBinding Light={StaticResource OutlineVariant}, Dark={StaticResource Outline}}"
                        StrokeThickness="1"
                        BackgroundColor="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource SurfaceDark}}"
                        WidthRequest="44"
                        HeightRequest="44"
                        IsVisible="{Binding IsMultiSelectMode, Converter={StaticResource InverseBoolConverter}}">
                    <Label Text="âš™"
                           FontSize="20"
                           TextColor="{AppThemeBinding Light={StaticResource OnSurface}, Dark={StaticResource TextPrimaryDark}}"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           Opacity="0.7">
                        <Label.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ToggleFiltersCommand}" />
                        </Label.GestureRecognizers>
                    </Label>
                </Border>

                <!-- Close Multi-Select (when active) -->
                <Border Grid.Column="3"
                        StrokeShape="RoundRectangle 14"
                        Stroke="{StaticResource Primary}"
                        StrokeThickness="1.5"
                        BackgroundColor="{AppThemeBinding Light={StaticResource PrimaryContainer}, Dark={StaticResource PrimaryDark}}"
                        WidthRequest="44"
                        HeightRequest="44"
                        IsVisible="{Binding IsMultiSelectMode}">
                    <Label Text="âœ•"
                           FontSize="22"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Primary}"
                           HorizontalOptions="Center"
                           VerticalOptions="Center">
                        <Label.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ClearSelectionCommand}" />
                        </Label.GestureRecognizers>
                    </Label>
                </Border>

            </Grid>

            <!-- Multi-Select Actions Bar -->
            <Border StrokeShape="RoundRectangle 14"
                    Stroke="{StaticResource Primary}"
                    StrokeThickness="1.5"
                    BackgroundColor="{AppThemeBinding Light={StaticResource PrimaryContainer}, Dark={StaticResource PrimaryDark}}"
                    IsVisible="{Binding IsMultiSelectMode}"
                    Padding="16,12">
                <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="8">
                    <Label Grid.Column="0"
                           Text="{Binding SelectionInfoText}"
                           Style="{StaticResource BodyLarge}"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Primary}"
                           VerticalOptions="Center" />

                    <Button Grid.Column="1"
                            Text="Seleziona tutto"
                            Command="{Binding SelectAllCommand}"
                            Style="{StaticResource OutlinedButton}"
                            Padding="12,8"
                            FontSize="13" />

                    <Button Grid.Column="2"
                            Text="Elimina"
                            Command="{Binding DeleteSelectedCommand}"
                            BackgroundColor="{StaticResource Danger}"
                            TextColor="White"
                            Padding="12,8"
                            FontSize="13"
                            CornerRadius="8" />
                </Grid>
            </Border>

            <!-- Filters Panel (Minimal) -->
            <Border IsVisible="{Binding IsFiltersVisible}"
                    StrokeShape="RoundRectangle 14"
                    Stroke="{AppThemeBinding Light={StaticResource OutlineVariant}, Dark={StaticResource Outline}}"
                    StrokeThickness="1"
                    BackgroundColor="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource SurfaceDark}}"
                    Padding="16">
                <VerticalStackLayout Spacing="14">
                    <Label Text="Filtri"
                           Style="{StaticResource TitleMedium}"
                           TextColor="{AppThemeBinding Light={StaticResource OnSurface}, Dark={StaticResource TextPrimaryDark}}" />

                    <!-- Date Range -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="8">
                        <VerticalStackLayout Grid.Column="0" Spacing="4">
                            <Label Text="Da" Style="{StaticResource LabelMedium}" />
                            <DatePicker Date="{Binding StartDate}"
                                       Format="dd/MM/yyyy"
                                       HorizontalOptions="Fill" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1" Spacing="4">
                            <Label Text="A" Style="{StaticResource LabelMedium}" />
                            <DatePicker Date="{Binding EndDate}"
                                       Format="dd/MM/yyyy"
                                       HorizontalOptions="Fill" />
                        </VerticalStackLayout>
                    </Grid>

                    <!-- Amount Range -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="8">
                        <VerticalStackLayout Grid.Column="0" Spacing="4">
                            <Label Text="Min (â‚¬)" Style="{StaticResource LabelMedium}" />
                            <Entry Placeholder="10,00"
                                   Text="{Binding MinAmountText}"
                                   Keyboard="Numeric" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1" Spacing="4">
                            <Label Text="Max (â‚¬)" Style="{StaticResource LabelMedium}" />
                            <Entry Placeholder="500,00"
                                   Text="{Binding MaxAmountText}"
                                   Keyboard="Numeric" />
                        </VerticalStackLayout>
                    </Grid>

                    <!-- Type Filter -->
                    <VerticalStackLayout Spacing="4">
                        <Label Text="Tipo" Style="{StaticResource LabelMedium}" />
                        <Picker SelectedIndex="{Binding SelectedTransactionType}">
                            <Picker.Items>
                                <x:String>Tutte</x:String>
                                <x:String>Solo Entrate</x:String>
                                <x:String>Solo Uscite</x:String>
                            </Picker.Items>
                        </Picker>
                    </VerticalStackLayout>

                    <!-- Action Buttons -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="12" Margin="0,6,0,0">
                        <Button Grid.Column="0"
                                Text="Azzera"
                                Command="{Binding ClearFiltersCommand}"
                                Style="{StaticResource OutlinedButton}" />

                        <Button Grid.Column="1"
                                Text="Applica"
                                Command="{Binding ApplyFiltersCommand}"
                                Style="{StaticResource FilledButton}" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

        </VerticalStackLayout>

        <!-- Transactions List -->
        <RefreshView Grid.Row="1"
                     Command="{Binding RefreshCommand}"
                     IsRefreshing="{Binding IsLoading}">
            <CollectionView ItemsSource="{Binding GroupedTransactions}"
                           IsGrouped="True"
                           EmptyView="Nessuna transazione trovata"
                           RemainingItemsThreshold="10"
                           RemainingItemsThresholdReachedCommand="{Binding LoadMoreTransactionsCommand}"
                           SelectionMode="None">

                <!-- Group Header (Minimal & Professional) -->
                <CollectionView.GroupHeaderTemplate>
                    <DataTemplate x:DataType="models:TransactionGroup">
                        <VerticalStackLayout Margin="16,12,16,8" Spacing="6">
                            <!-- Month Name -->
                            <Label Text="{Binding Name}"
                                   Style="{StaticResource TitleLarge}"
                                   TextColor="{AppThemeBinding Light={StaticResource OnSurface}, Dark={StaticResource TextPrimaryDark}}" />

                            <!-- Summary Stats (Inline) -->
                            <HorizontalStackLayout Spacing="16">
                                <Label Text="{Binding TransactionCount, StringFormat='{0} transazioni'}"
                                       Style="{StaticResource BodySmall}"
                                       TextColor="{AppThemeBinding Light={StaticResource OnSurfaceVariant}, Dark={StaticResource TextSecondaryDark}}" />

                                <Label Text="{Binding FormattedIncome}"
                                       Style="{StaticResource BodySmall}"
                                       TextColor="{StaticResource Success}" />

                                <Label Text="{Binding FormattedExpenses}"
                                       Style="{StaticResource BodySmall}"
                                       TextColor="{StaticResource Danger}" />
                            </HorizontalStackLayout>

                            <!-- Divider Line -->
                            <BoxView HeightRequest="1"
                                     BackgroundColor="{AppThemeBinding Light={StaticResource OutlineVariant}, Dark={StaticResource Outline}}"
                                     Opacity="0.3"
                                     Margin="0,4,0,0" />
                        </VerticalStackLayout>
                    </DataTemplate>
                </CollectionView.GroupHeaderTemplate>

                <!-- Transaction Item (Minimal Design like Dashboard) -->
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Transaction">
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="0">

                            <!-- CheckBox (Multi-Select) -->
                            <CheckBox Grid.Column="0"
                                     IsChecked="{Binding IsSelected}"
                                     CheckedChanged="OnCheckBoxChanged"
                                     Color="{StaticResource Primary}"
                                     IsVisible="{Binding Source={RelativeSource AncestorType={x:Type vm:TransactionsViewModel}}, Path=IsMultiSelectMode}"
                                     VerticalOptions="Center"
                                     Margin="16,0,8,0" />

                            <!-- SwipeView with Transaction Content -->
                            <SwipeView Grid.Column="1">
                                <!-- Swipe Actions -->
                                <SwipeView.LeftItems>
                                    <SwipeItems Mode="Execute">
                                        <SwipeItem Text="Elimina"
                                                  BackgroundColor="{StaticResource Danger}"
                                                  Command="{Binding Source={RelativeSource AncestorType={x:Type vm:TransactionsViewModel}}, Path=DeleteTransactionCommand}"
                                                  CommandParameter="{Binding .}" />
                                    </SwipeItems>
                                </SwipeView.LeftItems>

                                <SwipeView.RightItems>
                                    <SwipeItems Mode="Execute">
                                        <SwipeItem Text="Modifica"
                                                  BackgroundColor="{StaticResource Info}"
                                                  Command="{Binding Source={RelativeSource AncestorType={x:Type vm:TransactionsViewModel}}, Path=EditTransactionCommand}"
                                                  CommandParameter="{Binding .}" />
                                    </SwipeItems>
                                </SwipeView.RightItems>

                                <!-- Transaction Card (Minimal Style) -->
                                <Border Style="{StaticResource TransactionCardModern}">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnTransactionTapped" />
                                    </Border.GestureRecognizers>

                                    <Grid ColumnDefinitions="4,*,Auto" ColumnSpacing="12">

                                        <!-- Minimal Vertical Bar (like Dashboard) -->
                                        <BoxView Grid.Column="0"
                                                 WidthRequest="4"
                                                 HeightRequest="48"
                                                 CornerRadius="2"
                                                 VerticalOptions="Center"
                                                 Color="{Binding IsIncome, Converter={StaticResource IncomeToColorConverter}}" />

                                        <!-- Description & Date -->
                                        <VerticalStackLayout Grid.Column="1" Spacing="3" VerticalOptions="Center">
                                            <Label Text="{Binding Descrizione}"
                                                   Style="{StaticResource BodyLarge}"
                                                   FontAttributes="Bold"
                                                   LineBreakMode="TailTruncation"
                                                   MaxLines="1" />

                                            <Label Text="{Binding FormattedDate}"
                                                   Style="{StaticResource BodySmall}"
                                                   TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}" />

                                            <Label Text="{Binding Causale}"
                                                   Style="{StaticResource LabelSmall}"
                                                   TextColor="{AppThemeBinding Light={StaticResource OnSurfaceVariant}, Dark={StaticResource TextSecondaryDark}}"
                                                   LineBreakMode="TailTruncation"
                                                   MaxLines="1"
                                                   IsVisible="{Binding Causale, Converter={StaticResource IsNotNullConverter}}" />
                                        </VerticalStackLayout>

                                        <!-- Amount -->
                                        <Label Grid.Column="2"
                                               Text="{Binding FormattedAmount}"
                                               Style="{StaticResource TitleMedium}"
                                               FontAttributes="Bold"
                                               VerticalOptions="Center"
                                               HorizontalOptions="End">
                                            <Label.TextColor>
                                                <Binding Path="IsIncome" Converter="{StaticResource IncomeToColorConverter}" />
                                            </Label.TextColor>
                                        </Label>

                                    </Grid>
                                </Border>
                            </SwipeView>

                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <!-- MENU BOTTOM SHEET OVERLAY (Like Dashboard) -->
        <Grid Grid.Row="0" Grid.RowSpan="2"
              IsVisible="{Binding IsFabMenuOpen}"
              BackgroundColor="#80000000"
              VerticalOptions="Fill"
              HorizontalOptions="Fill">
            <Grid.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding ToggleFabMenuCommand}" />
            </Grid.GestureRecognizers>

            <!-- Menu Bottom Sheet -->
            <Border VerticalOptions="End"
                    StrokeShape="RoundRectangle 28,28,0,0"
                    BackgroundColor="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource SurfaceDark}}"
                    Padding="0"
                    StrokeThickness="0">
                <Border.Shadow>
                    <Shadow Brush="Black" Opacity="0.20" Offset="0,-4" Radius="20" />
                </Border.Shadow>

                <VerticalStackLayout Spacing="0">
                    <!-- Handle -->
                    <BoxView WidthRequest="40"
                             HeightRequest="4"
                             CornerRadius="2"
                             BackgroundColor="{AppThemeBinding Light={StaticResource OnSurfaceVariant}, Dark={StaticResource OutlineVariant}}"
                             Opacity="0.4"
                             HorizontalOptions="Center"
                             Margin="0,12,0,20" />

                    <!-- Menu Items -->

                    <!-- New Transaction -->
                    <Grid ColumnDefinitions="Auto,*,Auto"
                          Padding="24,16"
                          ColumnSpacing="16">
                        <Grid.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding AddTransactionCommand}" />
                        </Grid.GestureRecognizers>

                        <!-- Icon -->
                        <Border Grid.Column="0"
                                StrokeShape="RoundRectangle 12"
                                BackgroundColor="{AppThemeBinding Light={StaticResource PrimaryContainer}, Dark={StaticResource PrimaryDark}}"
                                WidthRequest="48"
                                HeightRequest="48"
                                Padding="12"
                                StrokeThickness="0">
                            <Label Text="ðŸ’°"
                                   FontSize="24"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                        </Border>

                        <!-- Text -->
                        <VerticalStackLayout Grid.Column="1" Spacing="2" VerticalOptions="Center">
                            <Label Text="Nuova Transazione"
                                   Style="{StaticResource BodyLarge}"
                                   FontAttributes="Bold" />
                            <Label Text="Aggiungi entrata o uscita"
                                   Style="{StaticResource BodySmall}"
                                   TextColor="{AppThemeBinding Light={StaticResource OnSurfaceVariant}, Dark={StaticResource TextSecondaryDark}}" />
                        </VerticalStackLayout>

                        <!-- Arrow -->
                        <Label Grid.Column="2"
                               Text="â€º"
                               FontSize="24"
                               TextColor="{AppThemeBinding Light={StaticResource OnSurfaceVariant}, Dark={StaticResource TextSecondaryDark}}"
                               VerticalOptions="Center" />
                    </Grid>

                    <!-- Divider -->
                    <BoxView HeightRequest="1"
                             BackgroundColor="{AppThemeBinding Light={StaticResource OutlineVariant}, Dark={StaticResource Outline}}"
                             Opacity="0.5"
                             Margin="24,0" />

                    <!-- Import -->
                    <Grid ColumnDefinitions="Auto,*,Auto"
                          Padding="24,16"
                          ColumnSpacing="16">
                        <Grid.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding GoToImportCommand}" />
                        </Grid.GestureRecognizers>

                        <!-- Icon -->
                        <Border Grid.Column="0"
                                StrokeShape="RoundRectangle 12"
                                BackgroundColor="{AppThemeBinding Light={StaticResource SecondaryContainer}, Dark={StaticResource SecondaryDark}}"
                                WidthRequest="48"
                                HeightRequest="48"
                                Padding="12"
                                StrokeThickness="0">
                            <Label Text="ðŸ“¥"
                                   FontSize="24"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                        </Border>

                        <!-- Text -->
                        <VerticalStackLayout Grid.Column="1" Spacing="2" VerticalOptions="Center">
                            <Label Text="Importa Transazioni"
                                   Style="{StaticResource BodyLarge}"
                                   FontAttributes="Bold" />
                            <Label Text="Carica da file CSV o Excel"
                                   Style="{StaticResource BodySmall}"
                                   TextColor="{AppThemeBinding Light={StaticResource OnSurfaceVariant}, Dark={StaticResource TextSecondaryDark}}" />
                        </VerticalStackLayout>

                        <!-- Arrow -->
                        <Label Grid.Column="2"
                               Text="â€º"
                               FontSize="24"
                               TextColor="{AppThemeBinding Light={StaticResource OnSurfaceVariant}, Dark={StaticResource TextSecondaryDark}}"
                               VerticalOptions="Center" />
                    </Grid>

                    <!-- Divider -->
                    <BoxView HeightRequest="1"
                             BackgroundColor="{AppThemeBinding Light={StaticResource OutlineVariant}, Dark={StaticResource Outline}}"
                             Opacity="0.5"
                             Margin="24,0" />

                    <!-- Export -->
                    <Grid ColumnDefinitions="Auto,*,Auto"
                          Padding="24,16"
                          ColumnSpacing="16">
                        <Grid.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding GoToExportCommand}" />
                        </Grid.GestureRecognizers>

                        <!-- Icon -->
                        <Border Grid.Column="0"
                                StrokeShape="RoundRectangle 12"
                                BackgroundColor="{AppThemeBinding Light={StaticResource TertiaryContainer}, Dark={StaticResource Tertiary}}"
                                WidthRequest="48"
                                HeightRequest="48"
                                Padding="12"
                                StrokeThickness="0">
                            <Label Text="ðŸ“¤"
                                   FontSize="24"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                        </Border>

                        <!-- Text -->
                        <VerticalStackLayout Grid.Column="1" Spacing="2" VerticalOptions="Center">
                            <Label Text="Esporta Transazioni"
                                   Style="{StaticResource BodyLarge}"
                                   FontAttributes="Bold" />
                            <Label Text="Salva in Excel o PDF"
                                   Style="{StaticResource BodySmall}"
                                   TextColor="{AppThemeBinding Light={StaticResource OnSurfaceVariant}, Dark={StaticResource TextSecondaryDark}}" />
                        </VerticalStackLayout>

                        <!-- Arrow -->
                        <Label Grid.Column="2"
                               Text="â€º"
                               FontSize="24"
                               TextColor="{AppThemeBinding Light={StaticResource OnSurfaceVariant}, Dark={StaticResource TextSecondaryDark}}"
                               VerticalOptions="Center" />
                    </Grid>

                    <!-- Divider -->
                    <BoxView HeightRequest="1"
                             BackgroundColor="{AppThemeBinding Light={StaticResource OutlineVariant}, Dark={StaticResource Outline}}"
                             Opacity="0.5"
                             Margin="24,0" />

                    <!-- Duplicates -->
                    <Grid ColumnDefinitions="Auto,*,Auto"
                          Padding="24,16,24,32"
                          ColumnSpacing="16">
                        <Grid.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding GoToDuplicatesCommand}" />
                        </Grid.GestureRecognizers>

                        <!-- Icon -->
                        <Border Grid.Column="0"
                                StrokeShape="RoundRectangle 12"
                                BackgroundColor="{AppThemeBinding Light=#FFF3E0, Dark=#E65100}"
                                WidthRequest="48"
                                HeightRequest="48"
                                Padding="12"
                                StrokeThickness="0">
                            <Label Text="ðŸ”"
                                   FontSize="24"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                        </Border>

                        <!-- Text -->
                        <VerticalStackLayout Grid.Column="1" Spacing="2" VerticalOptions="Center">
                            <Label Text="Cerca Duplicati"
                                   Style="{StaticResource BodyLarge}"
                                   FontAttributes="Bold" />
                            <Label Text="Trova transazioni duplicate"
                                   Style="{StaticResource BodySmall}"
                                   TextColor="{AppThemeBinding Light={StaticResource OnSurfaceVariant}, Dark={StaticResource TextSecondaryDark}}" />
                        </VerticalStackLayout>

                        <!-- Arrow -->
                        <Label Grid.Column="2"
                               Text="â€º"
                               FontSize="24"
                               TextColor="{AppThemeBinding Light={StaticResource OnSurfaceVariant}, Dark={StaticResource TextSecondaryDark}}"
                               VerticalOptions="Center" />
                    </Grid>
                </VerticalStackLayout>
            </Border>
        </Grid>

        <!-- FLOATING ACTION BUTTON (Same as Dashboard) -->
        <Grid Grid.Row="1"
              VerticalOptions="End"
              HorizontalOptions="End"
              Margin="0,0,20,20">
            <Border StrokeShape="RoundRectangle 28"
                    Background="{StaticResource GradientPrimary}"
                    WidthRequest="56"
                    HeightRequest="56"
                    StrokeThickness="0">
                <Border.Shadow>
                    <Shadow Brush="{StaticResource Primary}"
                            Offset="0,6"
                            Radius="16"
                            Opacity="0.4" />
                </Border.Shadow>

                <!-- Menu Icon (Grid 3x3) -->
                <Grid RowDefinitions="Auto,Auto,Auto"
                      ColumnDefinitions="Auto,Auto,Auto"
                      RowSpacing="4"
                      ColumnSpacing="4"
                      HorizontalOptions="Center"
                      VerticalOptions="Center">

                    <!-- Row 1 -->
                    <BoxView Grid.Row="0" Grid.Column="0" WidthRequest="6" HeightRequest="6" CornerRadius="1.5" Color="White" />
                    <BoxView Grid.Row="0" Grid.Column="1" WidthRequest="6" HeightRequest="6" CornerRadius="1.5" Color="White" />
                    <BoxView Grid.Row="0" Grid.Column="2" WidthRequest="6" HeightRequest="6" CornerRadius="1.5" Color="White" />

                    <!-- Row 2 -->
                    <BoxView Grid.Row="1" Grid.Column="0" WidthRequest="6" HeightRequest="6" CornerRadius="1.5" Color="White" />
                    <BoxView Grid.Row="1" Grid.Column="1" WidthRequest="6" HeightRequest="6" CornerRadius="1.5" Color="White" />
                    <BoxView Grid.Row="1" Grid.Column="2" WidthRequest="6" HeightRequest="6" CornerRadius="1.5" Color="White" />

                    <!-- Row 3 -->
                    <BoxView Grid.Row="2" Grid.Column="0" WidthRequest="6" HeightRequest="6" CornerRadius="1.5" Color="White" />
                    <BoxView Grid.Row="2" Grid.Column="1" WidthRequest="6" HeightRequest="6" CornerRadius="1.5" Color="White" />
                    <BoxView Grid.Row="2" Grid.Column="2" WidthRequest="6" HeightRequest="6" CornerRadius="1.5" Color="White" />
                </Grid>

                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding ToggleFabMenuCommand}" />
                </Border.GestureRecognizers>
            </Border>
        </Grid>

        <!-- Loading Indicator -->
        <ActivityIndicator Grid.Row="1"
                          IsRunning="{Binding IsLoading}"
                          IsVisible="{Binding IsLoading}"
                          Color="{StaticResource Primary}"
                          VerticalOptions="Center"
                          HorizontalOptions="Center" />

    </Grid>

</ContentPage>
