<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:MoneyMindApp.ViewModels"
             x:Class="MoneyMindApp.Views.ExportPage"
             Title="Esporta Transazioni"
             Shell.NavBarIsVisible="True">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="16">

            <!-- Date Range -->
            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray900}}"
                   Padding="16" CornerRadius="12">
                <VerticalStackLayout Spacing="12">
                    <Label Text="ðŸ“… Periodo" FontSize="18" FontAttributes="Bold"/>

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                        <VerticalStackLayout Grid.Column="0" Spacing="4">
                            <Label Text="Da" FontSize="14"/>
                            <DatePicker Date="{Binding StartDate}"
                                        Format="dd/MM/yyyy"/>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1" Spacing="4">
                            <Label Text="A" FontSize="14"/>
                            <DatePicker Date="{Binding EndDate}"
                                        Format="dd/MM/yyyy"/>
                        </VerticalStackLayout>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Export Options -->
            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray900}}"
                   Padding="16" CornerRadius="12">
                <VerticalStackLayout Spacing="12">
                    <Label Text="âš™ï¸ Opzioni Export" FontSize="18" FontAttributes="Bold"/>

                    <VerticalStackLayout Spacing="4">
                        <Label Text="Formato" FontSize="14"/>
                        <Picker ItemsSource="{Binding ExportFormats}"
                                SelectedIndex="{Binding SelectedFormatIndex}"/>
                    </VerticalStackLayout>

                    <HorizontalStackLayout Spacing="8">
                        <CheckBox IsChecked="{Binding IncludeHeader}"/>
                        <Label Text="Includi intestazione" VerticalOptions="Center"/>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- Preview -->
            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray900}}"
                   Padding="16" CornerRadius="12">
                <VerticalStackLayout Spacing="12">
                    <HorizontalStackLayout Spacing="8">
                        <Label Text="ðŸ“‹ Anteprima" FontSize="18" FontAttributes="Bold"/>
                        <Label Text="{Binding TransactionCount, StringFormat='({0} totali)'}"
                               FontSize="14" TextColor="Gray" VerticalOptions="Center"/>
                    </HorizontalStackLayout>

                    <CollectionView ItemsSource="{Binding PreviewTransactions}" HeightRequest="200">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame Padding="8" Margin="0,4" CornerRadius="8"
                                       BackgroundColor="{AppThemeBinding Light=White, Dark={StaticResource Gray600}}">
                                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                                        <VerticalStackLayout>
                                            <Label Text="{Binding Descrizione}" FontAttributes="Bold" LineBreakMode="TailTruncation"/>
                                            <Label Text="{Binding Data, StringFormat='{0:dd/MM/yyyy}'}" FontSize="12" TextColor="Gray"/>
                                        </VerticalStackLayout>
                                        <Label Grid.Column="1" Text="{Binding Importo, StringFormat='{0:C2}'}"
                                               FontAttributes="Bold" VerticalOptions="Center"/>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                        <CollectionView.EmptyView>
                            <Label Text="Nessuna transazione nel periodo selezionato"
                                   HorizontalTextAlignment="Center"
                                   TextColor="Gray"/>
                        </CollectionView.EmptyView>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

            <!-- Status -->
            <Label Text="{Binding StatusMessage}"
                   FontSize="14"
                   HorizontalTextAlignment="Center"
                   TextColor="{StaticResource Primary}"/>

            <!-- Loading -->
            <ActivityIndicator IsRunning="{Binding IsLoading}"
                               IsVisible="{Binding IsLoading}"
                               Color="{StaticResource Primary}"/>

            <!-- Action Buttons -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                <Button Grid.Column="0" Text="Annulla"
                        Command="{Binding CancelCommand}"
                        BackgroundColor="Gray"
                        TextColor="White"/>
                <Button Grid.Column="1" Text="ðŸ“¤ Esporta"
                        Command="{Binding ExportCommand}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"/>
            </Grid>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
